{{template "base" .}}

{{define "title"}}{{.Site.Name}} Stats{{end}}

{{define "content"}}
<h1>{{.Site.Name}} <span style="color: var(--text-muted); font-weight: 400;">{{.Site.Domain}}</span></h1>

<div class="stat-grid">
    <div class="stat-card">
        <div class="stat-value">{{.TotalViews}}</div>
        <div class="stat-label">Total Views</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{.TodayViews}}</div>
        <div class="stat-label">Today</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{.UniqueVisitors}}</div>
        <div class="stat-label">Unique Visitors</div>
    </div>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
    <div class="card">
        <h2>Top Pages</h2>
        {{if .TopPages}}
        <table>
            <thead>
                <tr>
                    <th>Path</th>
                    <th>Views</th>
                </tr>
            </thead>
            <tbody>
                {{range .TopPages}}
                <tr>
                    <td><code>{{.Path}}</code></td>
                    <td>{{.Views}}</td>
                </tr>
                {{end}}
            </tbody>
        </table>
        {{else}}
        <p style="color: var(--text-muted); padding: 1rem 0;">No pageviews recorded yet.</p>
        {{end}}
    </div>

    <div class="card">
        <h2>Top Referrers</h2>
        {{if .TopReferrers}}
        <table>
            <thead>
                <tr>
                    <th>Referrer</th>
                    <th>Views</th>
                </tr>
            </thead>
            <tbody>
                {{range .TopReferrers}}
                <tr>
                    <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{.Referrer}}</td>
                    <td>{{.Views}}</td>
                </tr>
                {{end}}
            </tbody>
        </table>
        {{else}}
        <p style="color: var(--text-muted); padding: 1rem 0;">No referrer data yet.</p>
        {{end}}
    </div>
</div>

<div class="card">
    <h2>Daily Stats (Last 30 Days)</h2>
    {{if .DailyStats}}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Views</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {{range .DailyStats}}
            <tr>
                <td>{{.Date}}</td>
                <td>{{.Views}}</td>
                <td style="width: 60%;">
                    <div style="background: var(--accent-primary); height: 8px; border-radius: 4px; width: {{.Views}}0px; max-width: 100%;"></div>
                </td>
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <p style="color: var(--text-muted); padding: 1rem 0;">No daily data yet.</p>
    {{end}}
</div>

<div class="card">
    <h2>Recent Pageviews</h2>
    {{if .RecentViews}}
    <table>
        <thead>
            <tr>
                <th>Time</th>
                <th>Path</th>
                <th>Referrer</th>
            </tr>
        </thead>
        <tbody>
            {{range .RecentViews}}
            <tr>
                <td style="white-space: nowrap; color: var(--text-muted);">{{.CreatedAt.Format "Jan 02 15:04"}}</td>
                <td><code>{{.Path}}</code></td>
                <td style="max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--text-muted);">{{if .Referrer}}{{.Referrer}}{{else}}<em>Direct</em>{{end}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <p style="color: var(--text-muted); padding: 1rem 0;">No pageviews recorded yet.</p>
    {{end}}
</div>

<div class="card">
    <h2>Tracking Code</h2>
    <p style="color: var(--text-secondary); margin-bottom: 1rem;">Add this script to your website:</p>
    <div class="code-block">
        <code>&lt;script src="{{.TrackerURL}}/tracker.js" async&gt;&lt;/script&gt;</code>
    </div>
</div>
{{end}}

